import{a as F,b as Y}from"./chunk-5E22ITST.js";import{c as U,d as Gt}from"./chunk-S4RKVEPS.js";import{a as Qt,b as Lt}from"./chunk-HXRZ6FVE.js";import{a as Ht,b as Ut,c as Yt,d as $t,e as Kt,f as Xt,g as Jt}from"./chunk-FJL2MCY3.js";import{a as oe}from"./chunk-64L7DANL.js";import{a as At,b as Ot,c as Nt,d as Rt,e as Bt,f as jt,h as z}from"./chunk-EMMCAKQR.js";import{a as Wt,b as Zt,c as te,h as ee}from"./chunk-F4T2NXLS.js";import{a as q,b as Q}from"./chunk-3LYTN6OR.js";import"./chunk-QVLUA4QC.js";import{b as kt,c as Tt}from"./chunk-VDIAIRGD.js";import{a as L}from"./chunk-V5J7M4I7.js";import{c as Vt}from"./chunk-IMZNUD52.js";import{a as G,b as zt}from"./chunk-5LB5J5WN.js";import{a as qt}from"./chunk-JWFBI43Q.js";import"./chunk-BRZQVLQ6.js";import{a as H,b as I}from"./chunk-R2WOP35W.js";import"./chunk-J3BG4ZKK.js";import{a as Et,b as yt,c as Dt,d as wt,g as It,h as Ft}from"./chunk-FXF7DOH7.js";import"./chunk-JJPOC4CD.js";import"./chunk-F2JFFDTT.js";import{b as gt,d as M,g as ht,h as Ct,k as Pt,m as vt,o as St,q as Mt,s as xt}from"./chunk-IJCGWU3B.js";import"./chunk-RGNDWIHZ.js";import"./chunk-J7DIVVOQ.js";import{ba as bt,n as J}from"./chunk-Y2G3PEDF.js";import{D as Z,Fb as g,Ga as c,Ha as u,Hb as l,Mb as A,Nb as at,Oa as nt,P as tt,Pa as rt,Pb as mt,Qb as st,Rb as r,Sb as i,Tb as b,Xb as P,_b as f,_c as ut,a as k,ac as h,ad as B,b as T,cd as ft,dd as j,ed as _t,fc as O,gc as N,gd as y,hc as R,ic as pt,jc as s,kc as _,lc as X,ma as et,mb as m,nb as d,rc as lt,sc as E,tc as dt,v as V,vc as ct,wa as ot,wc as D,xa as x,xc as w,ya as it}from"./chunk-5JFLDQZH.js";var ae=(a,t)=>({"card-promotion__status--active":a,"card-promotion__status--expired":t});function me(a,t){if(a&1){let e=P();r(0,"mat-card-actions",8)(1,"button",9),f("click",function(){c(e);let n=h();return u(n.onDisablePromotionByIdFromChild(n.promotion().id))}),r(2,"mat-icon"),s(3,"delete"),i(),s(4,"T\u1EAFt khuy\u1EBFn m\xE3i"),i()()}}var ne=(()=>{let t=class t{constructor(o){this.authService=o,this.PromotionStatusEnum=F,this.promotion=rt.required(),this.onDisablePromotion=nt()}isDisablePromotionMode(){return[q.StoreOwner].includes(this.authService.currentUser()?.role)}onDisablePromotionByIdFromChild(o){this.onDisablePromotion.emit(o)}};t.\u0275fac=function(n){return new(n||t)(d(Q))},t.\u0275cmp=x({type:t,selectors:[["app-card-promotion"]],inputs:{promotion:[ot.SignalBased,"promotion"]},outputs:{onDisablePromotion:"onDisablePromotion"},standalone:!0,features:[E],decls:19,vars:12,consts:[["appearance","outlined",1,"card-promotion"],[1,"card-promotion__header"],[1,"card-promotion__name"],[1,"card-promotion__discount","u-margin-top-small"],[1,"card-promotion__content"],[1,"card-promotion__expDate"],[1,"card-promotion__effDate"],[1,"card-promotion__status",3,"ngClass"],[1,"card-promotion__actions"],[1,"btn","btn--grad","btn--with-icon",3,"click"]],template:function(n,p){n&1&&(r(0,"mat-card",0)(1,"mat-card-header",1)(2,"mat-card-title",2),s(3),i(),r(4,"mat-card-subtitle",3),s(5),D(6,"percent"),i()(),r(7,"mat-card-content",4)(8,"p",5),s(9,"H\u1EBFt h\u1EA1n v\xE0o: "),r(10,"span"),s(11),i()(),r(12,"p",6),s(13,"C\xF3 hi\u1EC7u l\u1EF1c t\u1EEB: "),r(14,"span"),s(15),i()(),r(16,"p",7),s(17),i()(),g(18,me,5,0,"mat-card-actions",8),i()),n&2&&(m(3),_(p.promotion().name),m(2),X("Gi\u1EA3m gi\xE1 ",w(6,7,p.promotion().discount),""),m(6),_(p.promotion().expDate),m(4),_(p.promotion().effDate),m(),l("ngClass",ct(9,ae,p.promotion().status==p.PromotionStatusEnum.Active,p.promotion().status==p.PromotionStatusEnum.Expired)),m(),X(" ",p.promotion().status," "),m(),A(18,p.isDisablePromotionMode()?18:-1))},dependencies:[z,At,Bt,Nt,jt,Rt,Ot,Vt,y,ut,_t,zt,G],styles:[".card-promotion[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:8px}.card-promotion__header[_ngcontent-%COMP%]{padding:2.4rem;background-color:#f5f5f4;border-bottom:1px solid #d4d4d4;display:flex;flex-direction:row}.card-promotion__name[_ngcontent-%COMP%]{text-transform:uppercase;font-weight:900;font-size:2.8rem}.card-promotion__discount[_ngcontent-%COMP%]{font-size:2.4rem;font-weight:900;color:#f97316}.card-promotion__content[_ngcontent-%COMP%]{padding:2.4rem;display:flex;flex-direction:column;gap:2.4rem}.card-promotion__expDate[_ngcontent-%COMP%], .card-promotion__effDate[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:1.8rem}.card-promotion__expDate[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .card-promotion__effDate[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:900;font-size:2rem;color:#f97316}.card-promotion__status[_ngcontent-%COMP%]{font-size:1.8rem;text-transform:uppercase;padding:1.2rem;font-weight:900;justify-self:stretch;text-align:center;box-shadow:0 1px 4px 2px #0000001a;border:1px solid rgba(0,0,0,.1);background-color:#f5f5f4;letter-spacing:1.05px}.card-promotion__status--active[_ngcontent-%COMP%]{color:#ea580c}.card-promotion__status--expired[_ngcontent-%COMP%]{color:#343638}.card-promotion__actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;padding:2.4rem;padding-top:0}"]});let a=t;return a})();function de(a,t){if(a&1&&(r(0,"mat-error"),s(1),i()),a&2){let e=h();m(),_(e.getErrorMessage("code"))}}function ce(a,t){if(a&1&&(r(0,"mat-error"),s(1),i()),a&2){let e=h();m(),_(e.getErrorMessage("name"))}}function ue(a,t){if(a&1&&(r(0,"mat-error"),s(1),i()),a&2){let e=h();m(),_(e.getErrorMessage("discount"))}}function fe(a,t){if(a&1&&(r(0,"mat-error"),s(1),i()),a&2){let e=h();m(),_(e.getErrorMessage("expDate"))}}var v,$=(v=class{constructor(t,e,o,n,p,C){this.modalConfigFromParent=t,this.modalRef=e,this.promotionService=o,this.datePipe=n,this.notificationService=p,this.fb=C,this.promotionForm=this.fb.group({code:["",[M.required]],name:["",[M.required]],discount:[0,[M.required,M.min(0),M.max(1)]],expDate:["",[M.required]]})}ngOnInit(){}preventEnterKey(t){t.key==="Enter"&&t.preventDefault()}getErrorMessage(t){let e=this.promotionForm.get(t);return e?.hasError("required")?"B\u1EA1n ph\u1EA3i nh\u1EADp tr\u01B0\u1EDDng n\xE0y":e?.hasError("min")||e?.hasError("max")?"Khuy\u1EBFn m\xE3i \u1EDF trong kho\u1EA3ng t\u1EEB 0 t\u1EDBi 1":""}onSubmit(){if(this.promotionForm.valid){let t=T(k({},this.promotionForm.value),{discount:this.promotionForm.get("discount")?.value,expDate:this.datePipe.transform(this.promotionForm.get("expDate")?.value,"yyyy-MM-dd")?.toString()});this.promotionService.createPromotion(t).pipe(I(this)).subscribe({next:e=>{e&&(this.notificationService.show("T\u1EA1o khuy\u1EBFn m\xE3i th\xE0nh c\xF4ng"),this.modalRef.close())},error:e=>{this.notificationService.show(e.error.message)}})}}onCancelClick(){this.modalRef.close()}},v.\u0275fac=function(e){return new(e||v)(d(Ut),d(Ht),d(Y),d(j),d(L),d(Mt))},v.\u0275cmp=x({type:v,selectors:[["app-modal-create-promotion"]],standalone:!0,features:[lt([bt(),j]),E],decls:34,vars:11,consts:[["picker",""],[1,"form--modal",3,"keydown","ngSubmit","formGroup"],["mat-dialog-title","",1,"form--modal__title"],[1,"form--modal__content","u-padding-top-medium"],["matInput","","formControlName","code"],[4,"ngIf"],["matInput","","formControlName","name"],["matInput","","formControlName","discount"],["matInput","","formControlName","expDate",3,"matDatepicker"],["matIconSuffix","",3,"for"],[1,"form--modal__controls"],[1,"btn","btn--grad",3,"click"],["type","submit","cdkFocusInitial","",1,"btn","btn--primary",3,"disabled"]],template:function(e,o){if(e&1){let n=P();r(0,"form",1),f("keydown",function(C){return c(n),u(o.preventEnterKey(C))})("ngSubmit",function(){return c(n),u(o.onSubmit())}),r(1,"h2",2),s(2),i(),r(3,"mat-dialog-content",3)(4,"mat-form-field")(5,"mat-label"),s(6,"M\xE3"),i(),b(7,"input",4),g(8,de,2,1,"mat-error",5),i(),r(9,"mat-form-field")(10,"mat-label"),s(11,"T\xEAn"),i(),b(12,"input",6),g(13,ce,2,1,"mat-error",5),i(),r(14,"mat-form-field")(15,"mat-label"),s(16,"\u01AFu \u0110\xE3i"),i(),b(17,"input",7),g(18,ue,2,1,"mat-error",5),i(),r(19,"mat-form-field")(20,"mat-label"),s(21,"Ng\xE0y h\u1EBFt h\u1EA1n"),i(),b(22,"input",8),r(23,"mat-hint"),s(24,"MM/DD/YYYY"),i(),b(25,"mat-datepicker-toggle",9)(26,"mat-datepicker",null,0),g(28,fe,2,1,"mat-error",5),i()(),r(29,"mat-dialog-actions",10)(30,"button",11),f("click",function(){return c(n),u(o.onCancelClick())}),s(31),i(),r(32,"button",12),s(33),i()()()}if(e&2){let n=pt(27);l("formGroup",o.promotionForm),m(2),_(o.modalConfigFromParent.title),m(6),l("ngIf",o.promotionForm.controls.code.invalid),m(5),l("ngIf",o.promotionForm.controls.name.invalid),m(5),l("ngIf",o.promotionForm.controls.discount.invalid),m(4),l("matDatepicker",n),m(3),l("for",n),m(3),l("ngIf",o.promotionForm.controls.expDate.invalid),m(3),_(o.modalConfigFromParent.closeButtonLabel),m(),l("disabled",o.promotionForm.invalid),m(),_(o.modalConfigFromParent.saveButtonLabel)}},dependencies:[Ft,It,Et,Dt,yt,wt,y,B,xt,Pt,gt,ht,Ct,vt,St,Tt,kt,Jt,$t,Xt,Kt,ee,Wt,Zt,te]}),v);$=V([H()],$);var _e=["promotionsStatusDropdownRef"],ge=["nameSearchInputRef"],he=()=>[5,10,25,100];function Ce(a,t){if(a&1){let e=P();r(0,"button",13),f("click",function(){c(e);let n=h();return u(n.onOpenModalAddPromotion())}),r(1,"mat-icon"),s(2,"add"),i(),s(3,"Th\xEAm \u01B0u \u0111\xE3i"),i()}}function Pe(a,t){a&1&&(r(0,"div")(1,"p"),s(2,"No data fits your search"),i()())}function ve(a,t){if(a&1){let e=P();r(0,"app-card-promotion",14),f("onDisablePromotion",function(n){c(e);let p=h();return u(p.onDisablePromotionByIdFromParent(n))}),i()}if(a&2){let e=t.$implicit;l("promotion",e)}}var S,K=(S=class{constructor(t,e,o,n){this.promotionService=t,this.notificationService=e,this.viewModal=o,this.userService=n,this.promotionsStatusDropdown=[{name:"C\xF2n Hi\u1EC7u L\u1EF1c",value:F.Active},{name:"\u0110\xE3 H\u1EBFt H\u1EA1n",value:F.Expired}],this.promotionParams={pageIndex:0,pageSize:10,searchName:void 0,status:void 0},this.totalPromotions=0}ngOnInit(){this.loadPromotions()}isStoreOwner(){return this.userService.currentUser()?.role===q.StoreOwner}loadPromotions(){this.promotions$=this.promotionService.getPromotions(T(k({},this.promotionParams),{pageIndex:this.promotionParams.pageIndex+1})).pipe(Z(t=>(this.promotionParams.pageIndex=t.pageIndex-1,this.promotionParams.pageSize=t.pageSize,this.totalPromotions=t.count,t.data)),tt(t=>{throw console.error("Error loading promotions",t),t}))}onPageChange(t){this.promotionParams.pageIndex=t.pageIndex,this.promotionParams.pageSize=t.pageSize,this.loadPromotions()}onValueChangesNameFromParent(t){this.promotionParams.searchName=t,this.onResetPaginatorToFirstPage(),this.loadPromotions()}onSelectChangeStatusFromParent(t){this.promotionParams.status=t?.value,this.onResetPaginatorToFirstPage(),this.loadPromotions()}onResetPaginatorToFirstPage(){this.promotionParams.pageIndex=0,this.paginator&&this.paginator.firstPage()}onResetFilters(){this.promotionsStatusDropdownRef.onClearSelection(),this.nameSearchInputRef.onClearInputFilter(),this.promotionParams.searchName=void 0,this.promotionParams.status=void 0,this.loadPromotions()}onDisablePromotionByIdFromParent(t){this.promotionService.disablePromotion(t).pipe(I(this)).subscribe({next:e=>{this.loadPromotions(),this.notificationService.show("\u0110\xF3ng khuy\u1EBFn m\xE3i th\xE0nh c\xF4ng")},error:e=>{this.notificationService.show("C\xF3 l\u1ED7i x\u1EA3y ra, vui l\xF2ng th\u1EED l\u1EA1i")}})}onOpenModalAddPromotion(){let t={title:Qt.CreatePromotionTitle,mode:Lt.Create,closeButtonLabel:"\u0110\xF3ng",saveButtonLabel:"T\u1EA1o m\u1EDBi"};this.viewModal.open($,{disableClose:!0,width:"40%",height:"80%",enterAnimationDuration:"300ms",exitAnimationDuration:"300ms",data:t}).afterClosed().pipe(I(this)).subscribe({next:e=>{this.loadPromotions()}})}},S.\u0275fac=function(e){return new(e||S)(d(Y),d(L),d(Yt),d(Q))},S.\u0275cmp=x({type:S,selectors:[["app-promotions"]],viewQuery:function(e,o){if(e&1&&(O(_e,5),O(ge,5),O(U,5)),e&2){let n;N(n=R())&&(o.promotionsStatusDropdownRef=n.first),N(n=R())&&(o.nameSearchInputRef=n.first),N(n=R())&&(o.paginator=n.first)}},standalone:!0,features:[E],decls:19,vars:11,consts:[["promotionsStatusDropdownRef",""],["nameSearchInputRef",""],[1,"filter-controls","u-margin-bottom-small","mat-elevation-z2"],[1,"filter-controls__dropdowns"],["label","Tr\u1EA1ng th\xE1i",3,"onSelectionChange","options"],[1,"filter-controls__filter-and-reset"],["label","T\xECm ki\u1EBFm theo t\xEAn",3,"onValueChanges"],[1,"btn","btn--primary-dark","btn--with-icon",3,"click"],[1,"btn","btn--primary","btn--with-icon"],[1,"grid","grid--responsive","u-margin-top-small"],[4,"ngIf"],[3,"promotion"],["aria-label","Select page",1,"u-margin-top-small",2,"background-color","#FAFAFA",3,"page","length","pageSize","pageSizeOptions"],[1,"btn","btn--primary","btn--with-icon",3,"click"],[3,"onDisablePromotion","promotion"]],template:function(e,o){if(e&1){let n=P();r(0,"section",2)(1,"div",3)(2,"app-generic-dropdown",4,0),f("onSelectionChange",function(C){return c(n),u(o.onSelectChangeStatusFromParent(C))}),i()(),r(4,"div",5)(5,"app-generic-search",6,1),f("onValueChanges",function(C){return c(n),u(o.onValueChangesNameFromParent(C))}),i(),r(7,"button",7),f("click",function(){return c(n),u(o.onResetFilters())}),r(8,"mat-icon"),s(9,"filter_alt_off"),i(),s(10,"X\xF3a b\u1ED9 l\u1ECDc"),i()()(),g(11,Ce,4,0,"button",8),r(12,"section",9),g(13,Pe,3,0,"div",10),D(14,"async"),mt(15,ve,1,1,"app-card-promotion",11,at),D(17,"async"),i(),r(18,"mat-paginator",12),f("page",function(C){return c(n),u(o.onPageChange(C))}),i()}e&2&&(m(2),l("options",o.promotionsStatusDropdown),m(9),A(11,o.isStoreOwner()?11:-1),m(2),l("ngIf",w(14,6,o.promotions$)===null),m(2),st(w(17,8,o.promotions$)),m(3),l("length",o.totalPromotions)("pageSize",o.promotionParams.pageSize)("pageSizeOptions",dt(10,he)))},dependencies:[y,B,ft,z,Gt,U,G,oe,qt,ne]}),S);K=V([H()],K);var Se=[{path:"",component:K}],fo=(()=>{let t=class t{};t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=it({type:t}),t.\u0275inj=et({imports:[J.forChild(Se),J]});let a=t;return a})();export{fo as PromotionsRoutingModule};
