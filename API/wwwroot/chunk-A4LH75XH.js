import{a as w,b as I,c as R,d as f,e as u,h as T}from"./chunk-VSDKEZBR.js";import{b as y}from"./chunk-Y2G3PEDF.js";import{g as l,k as d,la as P,ra as p}from"./chunk-5JFLDQZH.js";var c=function(a){return a[a.POLICY=0]="POLICY",a[a.WARRANTY=1]="WARRANTY",a}(c||{});var j=(()=>{let r=class r{constructor(n,s){this.storage=n,this.httpClient=s,this.baseDocumentsPolicyPath="/documents/policy",this.baseDocumentsWarrantyPath="/documents/warranty",this.baseImagesPath="/images"}uploadFile(n){let s=`${this.baseDocumentsPolicyPath}/${n.name}`,m=u(this.storage,s),i=w(m,n);return new d(e=>{i.on("state_changed",t=>{let g=t.bytesTransferred/t.totalBytes*100;e.next({progress:g})},t=>{e.error(t)},()=>{f(i.snapshot.ref).then(t=>{e.next({progress:100,downloadUrl:t}),e.complete()}).catch(t=>{e.error(t)})})})}getLatestFile(n){let s="";switch(n){case c.POLICY:{s=this.baseDocumentsPolicyPath;break}case c.WARRANTY:{s=this.baseDocumentsWarrantyPath;break}}let m=u(this.storage,s),i=R(m);return new d(e=>{i.then(t=>l(this,null,function*(){if(t.items.length>0){let A=(yield Promise.all(t.items.map(o=>l(this,null,function*(){let h=yield I(o);return{item:o,updated:new Date(h.updated)}}))).then(o=>o.sort((h,D)=>D.updated.getTime()-h.updated.getTime())))[0].item;f(A).then(o=>{e.next(o),e.complete()}).catch(o=>{e.error(o)})}else e.error("No files found in specified path")})).catch(t=>{e.error(t)})})}};r.\u0275fac=function(s){return new(s||r)(p(T),p(y))},r.\u0275prov=P({token:r,factory:r.\u0275fac,providedIn:"root"});let a=r;return a})();export{c as a,j as b};
